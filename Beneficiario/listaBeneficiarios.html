<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Beneficiários - Alvorecer Digital</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f9; margin: 0; padding: 20px; }
        .container { max-width: 900px; background: white; padding: 20px; margin: auto; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        table th, table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        table th { background: #007bff; color: white; }
        .btn { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; margin-bottom: 15px; }
        .btn:hover { background: #0056b3; }
        .btn-inicio { display: inline-block; margin-bottom: 20px; padding: 10px 15px; background: #e0e0e0; text-decoration: none; color: #333; border-radius: 5px; font-weight: bold; }
        .delete-btn { background: #dc3545; color: #fff; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;}
    </style>
</head>
<body>

    <a href="../telainicial.html" class="btn-inicio">⬅ Voltar ao Início</a>

    <div class="container">
        <h1>Beneficiários (Banco de Dados)</h1>
        <button class="btn" onclick="window.location.href='alterarddosbeneficiarios.html'">Cadastrar Beneficiário</button>

        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Responsável</th>
                    <th>Idade</th>
                    <th>Endereço</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="beneficiariosTabela">
                <tr><td colspan="5" style="text-align:center">Carregando...</td></tr>
            </tbody>
        </table>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // CHAVES DE CONEXÃO COM O BANCO DE DADOS
        const supabaseUrl = 'https://qmbkynoymgmwjxjelkoc.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtYmt5bm95bWdtd2p4amVsa29jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNTkzMjgsImV4cCI6MjA3OTgzNTMyOH0.1aS3mB0md0T2BLMfYasCA9ZCgybvKEjV0qXZE6FV_wA'
        const supabase = createClient(supabaseUrl, supabaseKey)

        async function carregarTabela() {
            const tabela = document.getElementById("beneficiariosTabela");
            
            const { data, error } = await supabase
                .from('beneficiarios')
                .select('*')
                .order('nome_crianca', { ascending: true })

            if (error) {
                tabela.innerHTML = `<tr><td colspan="5">Erro: ${error.message}</td></tr>`;
                return;
            }

            if (data.length === 0) {
                tabela.innerHTML = `<tr><td colspan="5" style="text-align:center">Nenhum beneficiário encontrado.</td></tr>`;
                return;
            }

            tabela.innerHTML = "";

            data.forEach(b => {
                const linha = document.createElement("tr");
                linha.innerHTML = `
                    <td>${b.nome_crianca}</td>
                    <td>${b.nome_responsavel}</td>
                    <td>${b.idade}</td>
                    <td>${b.endereco}</td>
                    <td>
                        <button class="delete-btn" onclick="excluir(${b.id})">Excluir</button>
                    </td>
                `;
                tabela.appendChild(linha);
            });
        }

        window.excluir = async function(id) {
            if (confirm("Deseja realmente excluir este beneficiário?")) {
                const { error } = await supabase.from('beneficiarios').delete().eq('id', id);
                if (!error) carregarTabela();
                else alert("Erro: " + error.message);
            }
        }

        carregarTabela();
    </script>
</body>
</html>